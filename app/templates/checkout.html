{% extends "base.html" %}
{% block title %}Checkout — {{ settings.site_name }}{% endblock %}

{% block content %}
<div class="container py-5">
  <h1 class="page-title mb-4">Checkout</h1>

  <form method="post" novalidate>
    {{ form.hidden_tag() }}
    <div class="row g-4">

      <!-- ── Customer Details ── -->
      <div class="col-lg-7">
        <div class="checkout-card p-4">
          <h5 class="checkout-section-title mb-3">Delivery Details</h5>

          <div class="row g-3">
            <div class="col-12">
              {{ form.customer_name.label(class="form-label") }}
              {{ form.customer_name(class="form-control" + (" is-invalid" if form.customer_name.errors else "")) }}
              {% for e in form.customer_name.errors %}<div class="invalid-feedback">{{ e }}</div>{% endfor %}
            </div>
            <div class="col-md-6">
              {{ form.customer_email.label(class="form-label") }}
              {{ form.customer_email(class="form-control" + (" is-invalid" if form.customer_email.errors else ""), type="email") }}
              {% for e in form.customer_email.errors %}<div class="invalid-feedback">{{ e }}</div>{% endfor %}
            </div>
            <div class="col-md-6">
              {{ form.customer_phone.label(class="form-label") }}
              {{ form.customer_phone(class="form-control", type="tel") }}
            </div>
            <div class="col-12">
              {{ form.shipping_address.label(class="form-label") }}
              {{ form.shipping_address(class="form-control" + (" is-invalid" if form.shipping_address.errors else ""), rows=3) }}
              {% for e in form.shipping_address.errors %}<div class="invalid-feedback">{{ e }}</div>{% endfor %}
            </div>
            <div class="col-md-5">
              {{ form.city.label(class="form-label") }}
              {{ form.city(class="form-control") }}
            </div>
            <div class="col-md-3">
              {{ form.postal_code.label(class="form-label") }}
              {{ form.postal_code(class="form-control") }}
            </div>
            <div class="col-md-4">
              {{ form.country.label(class="form-label") }}
              {{ form.country(class="form-control") }}
            </div>
            <div class="col-12">
              {{ form.notes.label(class="form-label") }}
              {{ form.notes(class="form-control", rows=2, placeholder="Special instructions, gift message...") }}
            </div>
          </div>
        </div>
      </div><!-- /col -->

      <!-- ── Order Summary ── -->
      <div class="col-lg-5">
        <div class="order-summary p-4 sticky-top" style="top:80px">
          <h5 class="summary-title mb-3">Your Order</h5>

          {% for pid, item in cart.items() %}
          <div class="d-flex justify-content-between mb-2 summary-line">
            <span>{{ item.name }} <span class="text-muted">×{{ item.qty }}</span></span>
            <span>{{ settings.currency_symbol }}{{ '%.2f'|format(item.price|float * item.qty) }}</span>
          </div>
          {% endfor %}

          <hr>
          <div class="d-flex justify-content-between mb-2">
            <span>Subtotal</span>
            <span>{{ settings.currency_symbol }}{{ '%.2f'|format(totals.subtotal|float) }}</span>
          </div>
          <div class="d-flex justify-content-between mb-2">
            <span>Delivery</span>
            <span>
              {% if totals.delivery == 0 %}
                <span class="text-success fw-semibold">Free</span>
              {% else %}
                {{ settings.currency_symbol }}{{ '%.2f'|format(totals.delivery|float) }}
              {% endif %}
            </span>
          </div>
          <hr>
          <div class="d-flex justify-content-between fw-bold fs-5 mb-4">
            <span>Total</span>
            <span>{{ settings.currency_symbol }}{{ '%.2f'|format(totals.total|float) }}</span>
          </div>

          <button type="submit" class="btn btn-checkout w-100">
            <i class="bi bi-lock-fill me-2"></i>Place Order
          </button>
        </div>
      </div>

    </div><!-- /row -->
  </form>

</div>
{% endblock %}
